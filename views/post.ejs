<%- include('partials/header') -%>

  <div class="container postContainer">
    <div class="IMAGES">
      <h2 class="postTitle"><%= post.title %></h2>
      <div class="mainImageContainer">
        <img class="img-fluid mainImage" id ="leadImage" src="<%= post.mainImageURL%>" />
        <% if (post.galleryImages.length>0) { %>
          <div class="galleryContainer">
            <% for(let i = 0; i < post.galleryImages.length; i++) { %>
              <img class="gallery" src = "<%= post.galleryImages[i]['url'] %>">
            <% } %>
          </div>
        <% } %>
        <a class="btn btn-outline-success my-4" href="/category/<%= post.category %>">Keep Looking</a>
      </div>
    </div>
    <div class="postInfo">
      <p class=""><%= post.caption %></p>
      <% if (post.onSale==true) { %>
        <p class=""><s>$<%= Number.parseFloat(post.price).toFixed(2) %></s></p> 
        <p class="text-success">On Sale $<%= Number.parseFloat(post.price - post.discount).toFixed(2) %></p>                   
      <% } else { %>
        <p class="">$<%= Number.parseFloat(post.price).toFixed(2) %></p> 
      <% } %>
      <form class="addToCartForm">
        <div class="d-flex">
          <label for="selectQty" class="form-label">Quantity</label>
          <select id="selectQty" name="selectQty" class = 'mx-2 mb-3 selectQty'>
            <% for (let i = 1; i<=post.quantity; i++) { %>
              <option value="<%= i %>"><%= i %></option>
            <% } %>
          </select>
        </div>
        <div class="d-flex">
          <button 
            type='button' 
            class="btn btn-outline-success cartButton me-2" 
            data-stock = "<%=post.quantity%>"
            data-id="<%= post._id %>" 
            data-price="<%= Number.parseFloat(post.price - post.discount).toFixed(2) %>">Add to Cart</button>
          <a href= '/cart' class="btn btn-outline-success">Checkout</a>
        </div>
      </form>
    </div>
    <a href="/cart" class="shopping-cart" data-product-count= '0'>
      <span class="cart-icon">&#128722;</span>
    </a>
  </div>
</body>
<script>
  let productCount = 0;
  if (localStorage.getItem("count")) {
      productCount = parseInt(localStorage.getItem("count"));
  }
  document.querySelector('.shopping-cart').setAttribute('data-product-count', productCount)
</script>

<script src="/post.js"></script>
<script src="/header.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
</html>
